# AWS構成設計書

## 1. アーキテクチャ概要図

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AWS Cloud                                       │
│                                                                             │
│  ┌─────────────┐     ┌─────────────────────────────────────────────────┐   │
│  │  EventBridge │     │              API Gateway                        │   │
│  │  (Scheduler) │     │              (REST API)                         │   │
│  │   毎日9:00   │     └─────────────────────────────────────────────────┘   │
│  └──────┬──────┘                          │                                 │
│         │                                 │                                 │
│         ▼                                 ▼                                 │
│  ┌─────────────┐                   ┌─────────────┐                         │
│  │   Lambda    │                   │   Lambda    │                         │
│  │  (配信処理)  │                   │ (Webhook)   │                         │
│  └──────┬──────┘                   └──────┬──────┘                         │
│         │                                 │                                 │
│         │    ┌────────────────────────────┤                                 │
│         │    │                            │                                 │
│         ▼    ▼                            ▼                                 │
│  ┌─────────────┐                   ┌─────────────┐                         │
│  │  DynamoDB   │◄──────────────────│  DynamoDB   │                         │
│  │  (Users)    │                   │  (Users)    │                         │
│  └─────────────┘                   └─────────────┘                         │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────┐                                                           │
│  │ 外部API     │                                                           │
│  │(OpenWeather)│                                                           │
│  └─────────────┘                                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  LINE Platform  │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │     ユーザー     │
                    └─────────────────┘
```

## 2. AWSサービス構成

| サービス | 用途 |
|----------|------|
| API Gateway | LINE Webhookリクエストを受信 |
| Lambda | ビジネスロジック実行（Webhook処理、天気配信） |
| DynamoDB | ユーザー情報・地域設定を保存 |
| EventBridge | 毎日9:00の定期実行をトリガー |
| CloudWatch | ログ収集、メトリクス監視 |
| Secrets Manager | 認証情報を安全に保管 |

## 3. Lambda関数構成

### 3.1 Webhook処理Lambda

| 項目 | 値 |
|------|-----|
| 関数名 | `line-webhook-handler` |
| トリガー | API Gateway (POST /webhook) |
| 役割 | 地域設定・設定確認を処理 |
| タイムアウト | 30秒 |
| メモリ | 256MB |

### 3.2 天気配信Lambda

| 項目 | 値 |
|------|-----|
| 関数名 | `weather-broadcast-handler` |
| トリガー | EventBridge (cron: 0 0 * * ? *) |
| 役割 | 全ユーザーに天気情報を配信 |
| タイムアウト | 300秒 |
| メモリ | 512MB |

※ cron式はUTC 0:00 = JST 9:00
